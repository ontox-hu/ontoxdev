---
title: project predictions and pmids
author: Thomas Luechtefeld
date: '2022-02-28'
slug: project-predictions-and-pmids
categories: []
tags: []
---

```{r setup, include=F}
library(glue)
library(dplyr)
```

The sysrev projects [**Jonas-van-Ertvelde/AOP updating vub steatosis**](https://sysrev.com/p/113583)and [**jian-jiang/AOP updating vub steatosis**](https://sysrev.com/u/6128/p/103067) both import articles from pubmed.

**How to link sysrev article ids to pubmed ids?** \
Articles imported to Sysrev from pubmed track pmids in \`external_id\`:

```{r, cache=T, message=F}
aop = rbind(
  rsr::get_articles(103067),
  rsr::get_articles(113583))

aop |> 
  select(project_id,aid,datasource_name,external_id) |> 
  print(n=2)
```

The first article can be found at sysrev.com/p/`r aop$project_id[1]`/article/`r aop$aid[1]` and also at https://pubmed.ncbi.nlm.nih.gov/24151358/. 

**Filtering with machine learning** \
Both of these projects have predictions generated by Sysrev machine learning.

```{r load-predictions, cache=T}
# Warning, very large query and takes 5-6 minutes to run
aop.pred.raw  <- rbind(
  rsr::get_predictions(103067),
  rsr::get_predictions(113583))

# get the most recent predictions
aop.pred = aop.pred.raw |> 
  group_by(project_id) |> 
  filter(predict_run_id==max(predict_run_id)) 

aop.pred |> 
  select(project_id,predict_run_id,lid,value,probability) |> 
  print(n=2)
```

Filtering with `predict_run_id==max(predict_run_id)` in each project gives us the most recent predictions in each project. Now we can join with the labels defined in each project:

```{r}
aop.lbl <- rbind(
  rsr::get_labels(103067),
  rsr::get_labels(113583)) |> 
  select(lid,short_label)

# TODO, this vignette is incomplete come back and finish it
aop.pred |> 
  inner_join(aop.lbl,by="lid") |> 
  filter(short_label=="Include") |> 
  select(project_id,aid,short_label,value,probability)
```


